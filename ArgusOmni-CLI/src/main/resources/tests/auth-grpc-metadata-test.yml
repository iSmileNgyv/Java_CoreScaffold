# Test metadata (authorization header) support in gRPC

env:
  GRPC_HOST: "localhost:5051"
  PROTO_FILE: "/Users/ismile/IdeaProjects/Java_CoreScaffold/Auth/src/main/proto/auth.proto"

tests:
  - name: "Register new user"
    type: GRPC
    grpc:
      proto: "{{PROTO_FILE}}"
      host: "{{GRPC_HOST}}"
      service: "AuthService"
      method: "Register"
      request:
        username: "mt{{date:HHmmss}}"
        password: "Test123!@#"
        name: "Metadata"
        surname: "Test"
        phone_number: "+994501{{date:HHmmss}}"
        email: "mt{{date:HHmmss}}@example.com"
      timeout: 5000
    extract:
      accessToken: "$.token"
      refreshToken: "$.refreshToken"
      username: "$.user.username"

  - name: "Login to get fresh tokens"
    type: GRPC
    grpc:
      proto: "{{PROTO_FILE}}"
      host: "{{GRPC_HOST}}"
      service: "AuthService"
      method: "Login"
      request:
        username: "{{username}}"
        password: "Test123!@#"
      timeout: 5000
    extract:
      accessToken: "$.token"
      refreshToken: "$.refreshToken"

  - name: "Logout with authorization header (metadata test)"
    type: GRPC
    grpc:
      proto: "{{PROTO_FILE}}"
      host: "{{GRPC_HOST}}"
      service: "AuthService"
      method: "Logout"
      request:
        refresh_token: "{{refreshToken}}"
      metadata:
        authorization: "Bearer {{accessToken}}"
      timeout: 5000
